---
title: osTicket API

layout: internal
permalink: /osticket/api/

# Spamty API Doc (http://dev.spamty.eu/)
# Copyright (C) 2016 by Philipp & Spamty.eu
---
<h2>Create Ticket API</h2>
<ul>
	<li><a href="http://www.andrewbennett.com.au/2013/06/creating-a-ticket-via-the-osticket-api-using-php-cron/">Tutorial</a></li>
	<li><a href="https://github.com/osTicket/osTicket-1.8/blob/develop/setup/doc/api/tickets.md">Ticket API Documentation</a></li>
</ul>
<h2>Create User API</h2>
<p>Not contained in osTicket. Has to be added manually from GitHub.</p>
<p>This API requires only the <code>email</code> parameter. It will only create a new user if it doesn't already exist. It returns the user ID with status code 201.</p>
<ul>
	<li><a href="https://github.com/osTicket/osTicket-1.8/pull/2132">Create User API</a></li>
</ul>

<h2>Code</h2>
<pre class="prettyprint">
&lt;?php 
$config = array(
	// URL to api/tickets.json
	'url'=>'https://help.spamty.eu/api/tickets.json',
	// URL to api/users.json
	'urlUsers'=>'https://help.spamty.eu/api/users.json',
	// API's Key (see admin panel on how to generate a key)
	'key'=>'6D8FB6F316251E83683F27F40E667147'
);

// data for the ticket
$data = array(
	"alert" => "true",
	"autorespond" => "true",
	"source" => "API",
	"topicId" => 12,
	"ip" => "172.0.0.1",
	"name" => "Some User",
	"email" => "email@example.com",
	"subject" => "Message title",
	"message" => "Some content for the message"
); 

// Create new User if it does not exist
// Convert the data array into json to POST to the API with curl below.
$data_stringUser = json_encode(array( "email" => $data['email'] ));
// curl post
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $config['urlUser']);
curl_setopt($ch, CURLOPT_POST, 1);
curl_setopt($ch, CURLOPT_POSTFIELDS, $data_stringUser);
curl_setopt($ch, CURLOPT_USERAGENT, 'osTicket API Client v1.8');
curl_setopt($ch, CURLOPT_HEADER, TRUE);
curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); 
curl_setopt($ch, CURLOPT_HTTPHEADER, array( 'Expect:', 'X-API-Key: '.$config['key']));
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, FALSE);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
$resultUser = curl_exec($ch); // this API returns the user ID number
curl_close($ch);


// Convert the data array into json to POST to the API with curl below.
$data_string = json_encode($data);
// curl post
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $config['url']);
curl_setopt($ch, CURLOPT_POST, 1);
curl_setopt($ch, CURLOPT_POSTFIELDS, $data_string);
curl_setopt($ch, CURLOPT_USERAGENT, 'osTicket API Client v1.8');
curl_setopt($ch, CURLOPT_HEADER, TRUE);
curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); 
curl_setopt($ch, CURLOPT_HTTPHEADER, array( 'Expect:', 'X-API-Key: '.$config['key']));
curl_setopt($ch, CURLOPT_FOLLOWLOCATION, FALSE);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
$result = curl_exec($ch);
curl_close($ch);

// search for HTTP status code and store it in $status[1] 
preg_match('/HTTP\/.* ([0-9]+) .*/', $result, $status);
// if not ok (HTTP/201 Created)
if($status[1] != 201){
	// send email with ticket
	$sendTo = 'contact@spamty.eu';
	$subject = $data['subject'];
	$message = $data['message']."\n \n Message from: ".$data['name']."\n ".$data['email']."\n Sent on: ".date("m d, Y H:i");
	$message = wordwrap($message, 70);
	$header = 'From: '.$data['email'];
	mail($sendTo, $subject, $message, $header);

	// send email with error message to developers
	$sendTo = 'contact@spamty.eu';
	$subject = "Error with osTicket API";
	$message = "osTicket API in includes/osticket.php returned the following: \n".$result." \n \n This data was passed to osTicket: \n".$data_string." \n \n See log: http://help.spamty.eu/scp/logs.php \n \n Sent on: ".date("m d, Y H:i");
	$message = wordwrap($message, 70);
	$header = 'From: dev_web@spamty.eu';
	mail($sendTo, $subject, $message, $header);
}
</pre>